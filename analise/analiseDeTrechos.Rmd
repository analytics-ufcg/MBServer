---
title: "Analise de pernas de ônibus"
author: "Luiz Alberto Fonseca"
date: "September 5, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(ggplot2)
library(tidyverse)
```


```{r}
dados.bulma <- read_csv("dadostratados.csv")
```

Comparando a hora com as demais horas do dia
(Para aquele dia, como se comporta aquela hora em comparação com as demais)

```{r}
summarised.dates <- dados.bulma %>% group_by(date) %>%
  summarise(meanDuration = mean(duration),
            medianDuration = median(duration))


temp1 <- dados.bulma %>% select(date, hourOrig, hourDest, duration)
temp1 <- left_join(temp1, summarised.dates, by = "date")

# Diferença entre cada duração e a duração mediana do dia
temp1 <- temp1 %>% mutate(
  diffFromMedian = duration - medianDuration
)

# Mediana das diferenças por hora
temp2 <- temp1 %>% group_by(hourOrig) %>%
  summarise(
   medianOfDiffs = median(diffFromMedian)
)

# plot
ggplot(temp2, aes(as.factor(hourOrig), medianOfDiffs)) +
  geom_bar(stat = "identity", fill = "#2f4c56", legend = FALSE) + 
  scale_y_continuous("Média das diferenças (em segundos)") +
  theme(axis.title.x = element_blank()) +
  labs(title = "Mediana das diferenças entre as durações de viagens e a duração mediana do dia")

```

## Dia da semana
```{r}
summarised.weeks <- dados.bulma %>% group_by(weekOfYear) %>%
  summarise(medianWeek = median(duration))

temp3 <- dados.bulma %>% select(weekOfYear, weekDay, duration)
temp3 <- left_join(temp3, summarised.weeks, by = "weekOfYear")

# Diferença entre cada duração e a duração mediana da semana
temp3 <- temp3 %>% mutate(
  diffFromMedian = duration - medianWeek
)

# Mediana das diferenças por dia da semana
temp4 <- temp3 %>% group_by(weekDay) %>%
  summarise(
   medianOfDiffs = median(diffFromMedian)
)

ggplot(temp4, aes(as.factor(weekDay), medianOfDiffs)) +
  geom_bar(stat = "identity", fill = "#2f4c56", legend = FALSE) + 
  scale_y_continuous("Média das diferenças (em segundos)") +
  theme(axis.title.x = element_blank()) +
  labs(title = "Quanto (em média) a mediana das durações de cada dia da semana difere \nda mediana das durações da semana")
```

## Área da cidade

```{r}
library(ggmap)

city.area <- dados.bulma %>% select(shapeLatOrig, shapeLonOrig, busStopIdOrig, busStopIdDest, shapeLatDest, shapeLonDest, velocityKmh)
```

